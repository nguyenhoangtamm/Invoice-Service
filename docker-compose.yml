version: "3.8"

services:
    # Invoice API
    invoice-api:
        build:
            context: .
            dockerfile: Invoice.API/Dockerfile
        container_name: invoice-api-prod
        environment:
            ASPNETCORE_ENVIRONMENT: ${ASPNETCORE_ENVIRONMENT}
            ASPNETCORE_URLS: http://+:80
            ConnectionStrings__DefaultConnection: Host=${DB_HOST};Port=${DB_PORT};Database=${DB_NAME};Username=${DB_USER};Password=${DB_PASSWORD};SSL Mode=Require;Trust Server Certificate=true;
            JwtSettings__Key: ${JWT_KEY}
            JwtSettings__Issuer: ${JWT_ISSUER}
            JwtSettings__Audience: ${JWT_AUDIENCE}
            JwtSettings__ExpiresInMinutes: ${JWT_EXPIRES_IN_MINUTES}
            Blockchain__RpcUrl: ${BLOCKCHAIN_RPC_URL}
            Blockchain__ChainId: ${BLOCKCHAIN_CHAIN_ID}
            Blockchain__PrivateKey: ${BLOCKCHAIN_PRIVATE_KEY}
            Blockchain__ContractAddress: ${BLOCKCHAIN_CONTRACT_ADDRESS}
            EmailSettings__SmtpHost: ${EMAIL_SMTP_HOST}
            EmailSettings__SmtpPort: ${EMAIL_SMTP_PORT}
            EmailSettings__SmtpUsername: ${EMAIL_SMTP_USERNAME}
            EmailSettings__SmtpPassword: ${EMAIL_SMTP_PASSWORD}
            EmailSettings__SenderEmail: ${EMAIL_SENDER}
            EmailSettings__SenderDisplayName: ${EMAIL_SENDER_NAME}
            GoogleDriveSettings__CredentialFilePath: ${GOOGLE_DRIVE_CREDENTIALS_PATH}
            GoogleDriveSettings__FolderId: ${GOOGLE_DRIVE_FOLDER_ID}
        ports:
            - "${APP_PORT}:80"
        volumes:
            - ./Invoice.API/wwwroot:/app/wwwroot
            - ./logs:/app/logs
        networks:
            - invoice-network-prod
        restart: always
        logging:
            driver: "json-file"
            options:
                max-size: "10m"
                max-file: "3"

networks:
    invoice-network-prod:
        driver: bridge
